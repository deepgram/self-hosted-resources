# TTS K6 Benchmarking

## Implementation

This script tests all TTS voices at multiple character input lengths and levels of concurrent requests.

It tests all 12 voices (as of May 2024).

It tests twelve different input texts with character lengths of 6, 12, 18, 38, 72, 179, 300, 441, 529, 768, 995, 1991.

It tests 1, 2, 3, 4, 6, 8, 16, 24, 32 concurrent requests.

When the first 503 error arises, the test is aborted. This is because once one 503 occurs, performance rapidly deteriorates and the system does not recover.

## Usage

To run: `k6 run k6tts.js`

An optional `INPUT_LENGTHS` command line argument accepts values `short`, `medium`, `long`, `all` (defaults to `all` when none specified).

`k6 run k6tts.js --INPUT_LENGTHS=short`

`short`: 1-2 sentences (6, 12, 18, 38 characters)

`medium`: 3-7 sentences (72, 179, 300, 441 characters)

`long`: 9-30 sentences (529, 768, 995, 1991 characters)

`all`: 1-30 sentences (6, 12, 18, 38, 72, 179, 300, 441, 529, 768, 995, 1991 characters)

## Metrics

The primary metric is characters per second. To elaborate, this is the number of input characters whose corresponding audio is generated by TTS. For instance, if the phrase "Hello" took one second to voice, that would be 5 characters per second.

The base metrics are defined in K6 as `scenario_NVU_characters`, where `N` is the number of parallel threads.

## Output and interpretation

At each level of concurrency, the characters/second metric is reported. This is calculated through the `scenario_NVU_characters` character counts, divided by the number of seconds each scenario ran (30 seconds for 1 or 2 parallel threads, 90 seconds for 3-32 parallel threads).

The key outputs of the script are as follows:

### Throughput

Listed in units of characters per second.

```
INFO[0532] scenario_characters_01VU: X characters/second  source=console
INFO[0532] scenario_characters_02VU: X characters/second  source=console
INFO[0532] scenario_characters_04VU: X characters/second  source=console
INFO[0532] scenario_characters_08VU: X characters/second  source=console
INFO[0532] scenario_characters_16VU: X characters/second  source=console
INFO[0532] scenario_characters_24VU: X characters/second  source=console
INFO[0532] scenario_characters_32VU: X characters/second  source=console
```

### Latency

Listed in units of milliseconds, across average, min, median, max, p90, and p95.

```
     scenario_latency_01VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
     scenario_latency_02VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
     scenario_latency_03VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
     scenario_latency_04VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
     scenario_latency_06VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
     scenario_latency_08VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
     scenario_latency_16VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
     scenario_latency_24VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
     scenario_latency_32VU..........: avg=X  min=X  med=X  max=X  p(90)=X  p(95)=X
```

##  Assumptions and extensions

Because the voices and input character lengths are randomized, metrics take a few general situations into account.

To analyze a single voice or input character length, the script may be edited to specify a list of one voice in the `voices` array, or a list of one phrase in the `phrases` array.

## Visualize the results

Paste the metrics output into the `VU_data_{short|medium|long|all}` variables within the `plot_tts` Python scripts for latency and throughput.

Run: `python3 plot_tts_throughput.py`, `python3 plot_tts_latency.py`
